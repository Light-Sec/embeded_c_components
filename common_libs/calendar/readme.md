# 软件万年历实现

应用系统实现诸如linux date万年历的功能，一般情况下，嵌入式系统，硬件上做法一般有如下几种：

第一种，搭载一颗永久不断电的时钟芯片（系统断电可由纽扣电池供电）；

第二种，片上有一直在运行的硬件万年历的外设（系统断电可由纽扣电池供电）；

第三种，片上有一个一直在运行的硬件定时器的外设（系统断电可由纽扣电池供电）；



#### 第一种具体做法

1）系统开机时刻，从时钟芯片上读取当前硬件万年历时间，一般能取到year-month-day hour:minute:second，有时还有时区。

2）计算开机时刻的时间戳SecondCountRTC（从2000-01-01 00:00:00到该硬件万年历时间走过的秒数）。详见接口`set_system_clock()`。

3）之后，运行一个周期性1秒的软件定时器，在定时器中断里，将SecondCountRTC加1。

4）应用程序，每次要获取当前时刻的软件万年历时间，只需调用一个负责将当前时刻的时间戳（从2000-01-01 00:00:00到此刻的走过的秒数）转为软件万年历时间的接口`get_wall_clock_time()`即可。


详见`calendar.c`实现。


#### note
1）应用程序，如果要获取当前时刻的标准时间戳（从1970-01-01 00:00:00到此刻的走过的秒数），则调用`get_curr_timestamp_int()`和`linux_mktime()`

详见`datetime.c`实现。


